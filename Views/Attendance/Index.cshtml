
@{
    ViewData["Title"] = "Index";
    Layout = null;
}

<link href="~/layui/css/layui.css" rel="stylesheet" />
<script src="~/layui/layui.js"></script>
<script src="~/lib/jquery/dist/jquery.js"></script>
<script src="~/lib/jquery/dist/jquery.min.js"></script>

<script type="text/javascript">
    layui.use(['form', 'table', 'layer', 'laydate'], function (obj) {
        var $ = layui.$;
        var table = layui.table;
        var form = layui.form;
        var layer = layui.layer;
        var laydate = layui.laydate;
        var index = layer.loading; //添加laoding,0-2两种方式
        laydate.render({
            elem: '#dtStartTime',
            type: 'date'
        });
        laydate.render({
            elem: '#dtEndTime',
            type: 'date'
        });
        //第一个实例
        table.render({
            elem: '#alarmTable',
            loading: true, //翻页加loading
            url: "/Attendance/Load", //数据接口
            request: {
                pageName: 'pageIndex',//页码的参数名称，默认：page
                limitName: 'pageSize' //每页数据量的参数名，默认：limit
            },
            cols: [[
                { field: 'uid', title: '船员编号', width: 180 },
                { field: 'name', title: '船员名称', width: 120 },
                { field: 'time', title: '打卡时间', width: 200 },
                {
                    field: 'enableAttendanceIn', title: '考勤', width: 120, templet: function (e) {
                        if (e.enableAttendanceIn) {
                            return "入";
                        } else {
                            return "出";
                        }
                    }
                },
                {
                    field: 'type', title: '略缩图', width: 150, templet: function (e) {
                        var html = '<img style="width:800px;height:30px" ondblclick="showBigImage(this)"  src="data:image/jpeg;base64,' + e.picture + '"/>';
                        return html;
                    }
                }
            ]],
            limit: 10,
            limits: [10, 20, 30, 40, 50],
            page: {
                groups: 5 //只显示 5 个连续页码
            }, done: function (res) {
                //返回数据执行回调函数
                layer.close(index);
                //返回数据关闭loading
            }
        });
        form.on("submit(query)", function (obj) {
            var data = {
                uid: obj.field.uid,
                name: obj.field.name,
                type: parseInt(obj.field.type),
                startTime: obj.field.startTime,
                endTime: obj.field.endTime
            }
            table.reload('alarmTable', {
                url: "/Attendance/QueryPage",
                where: data,
                request: {
                    pageName: 'pageIndex',//页码的参数名称，默认：page
                    limitName: 'pageSize' //每页数据量的参数名，默认：limit
                },
                page: {
                    curr: 1
                },
                done: function (res) {
                    form.render();
                }
            });
            return false;
        });
    });
    function showBigImage(e) {
        layui.use('layer', function () { //独立版的layer无需执行这一句
            var $ = layui.jquery, layer = layui.layer; //独立版的layer无需执行这一句
            var x = document.documentElement.clientWidth / 6;
            var y = document.documentElement.clientHeight / 6;
            var windowW = 960;
            var windowH = 540;
            layer.open({
                type: 1,
                offset: [y + "px", x + "px"],
                title: false,
                closeBtn: true,
                id: 'LAY_layuipro',
                shadeClose: true, //点击阴影关闭
                area: [windowW + 'px', windowH + 'px'], //宽高
                content: "<img style=\"position: absolute;width:100%;height:100%\" src=" + $(e).attr('src') + " />"
            });
        });
    }
</script>
<div style="margin:20px;width:96%">
    <form class="layui-form" action="" id="dataFrm" lay-filter="dataFrm">
        <div class="layui-form-item">
            <label class="layui-form-label">船员编号</label>
            <div class="layui-input-inline" style="width:100px">
                <input name="uid" class="layui-input" type="text" placeholder="请输入" autocomplete="off">
            </div>
            <label class="layui-form-label">船员名称</label>
            <div class="layui-input-inline" style="width:100px">
                <input name="name" class="layui-input" type="text" placeholder="请输入" autocomplete="off">
            </div>
            <label class="layui-form-label">时间起</label>
            <div class="layui-input-inline" style="width:100px">
                <input name="startTime" class="layui-input" id="dtStartTime" placeholder="yyyy-MM-dd" type="text" autocomplete="off" readonly>
            </div>
            <label class="layui-form-label">时间止</label>
            <div class="layui-input-inline" style="width:100px">
                <input name="endTime" class="layui-input" id="dtEndTime" placeholder="yyyy-MM-dd" type="text" autocomplete="off" readonly>
            </div>
            <button class="layui-btn" type="submit" lay-submit="" lay-filter="query">查询</button>
        </div>
    </form>
    <table class="layui-table" id="alarmTable" layer-filter="alarmTable"></table>
</div>



@*<script type="text/javascript">
        var page = 1; //设置首页页码
        var limit = 2; //设置一页显示的条数
        var total; //总条数
        $(function () {
            loadData();
            getdate();
        });
        function loadData() {
            $.ajax({
                url: "/Attendance/Load",
                type: "get",
                dataType: "json",
                data: {
                    pageIndex: page,
                    pageSize: limit
                },
                contentType: "application/json;chartset=utf-8",
                success: function (res) {
                    if (res.code == 0) {
                        total = res.count;
                        var tb = res.data;
                        SpliHtml(tb);
                        getPage();
                    }
                }
            });
        }
        //时间控件
        function getdate() {
            layui.use('laydate', function () {
                var laydate = layui.laydate;
                var layer = layui.layer;
                laydate.render({
                    elem: '#dtStartTime',
                    type: 'date'
                });
            });
            layui.use('laydate', function () {
                var laydate = layui.laydate;
                var layer = layui.layer;
                laydate.render({
                    elem: '#dtEndTime',
                    type: 'date'
                });
            })
        };
        //拼接数据
        function SpliHtml(tb) {
            var html = "";
            if (tb.length > 0) {
                for (var i = 0; i < tb.length; i++) {
                    html += '<tr>';
                    html += '<td>' + tb[i].uid + '</td>';
                    html += '<td>' + tb[i].name + '</td>';
                    html += '<td>' + tb[i].time + '</td>';
                    if (tb[i].enableAttendanceIn) {
                        html += '<td>入</td>';
                    } if (true) {
                        html += '<td>出</td>';
                    }
                    html += '<td><img style="width:800px;height:30px"  ondblclick="showBigImage(this)"  src="data:image/jpeg;base64,' + tb[i].picture + '"/></td>';
                }
            }
            $("#tblist").html(html);
        }
        function showBigImage(e) {
            layui.use('layer', function () { //独立版的layer无需执行这一句
                var $ = layui.jquery, layer = layui.layer; //独立版的layer无需执行这一句
                var x = document.documentElement.clientWidth / 6;
                var y = document.documentElement.clientHeight / 6;
                var windowW = 960;
                var windowH = 540;
                layer.open({
                    type: 1,
                    offset: [y + "px", x + "px"],
                    title: false,
                    closeBtn: true,
                    id: 'LAY_layuipro',
                    shadeClose: true, //点击阴影关闭
                    area: [windowW + 'px', windowH + 'px'], //宽高
                    content: "<img style=\"position: absolute;width:100%;height:100%\" src=" + $(e).attr('src') + " />"
                });
            });
        }
        //分页处理
        function getPage() {
            layui.use('laypage', function () {
                var laypage = layui.laypage;
                var layer = layui.layer;
                laypage.render({
                    elem: 'pages',
                    count: total, //数据总数，从服务端得到
                    limit: limit,
                    jump: function (obj, first) {
                        page = obj.curr; //改变当前页码
                        limit = obj.limit;
                        if (!first) {
                            Query(page, false);
                        }
                    }
                });
            });
        }
        //查询
        function Query(pageIndex, isRefresh = true) {
            var uid = $("#txtUid").val();
            var name = $("#txtName").val();
            var startTime = $("#dtStartTime").val();
            var endTime = $("#dtEndTime").val();
            var data = {
                uid: uid,
                name: name,
                startTime: startTime,
                endTime: endTime,
                pageIndex: pageIndex,
                pageSize: limit
            }
            $.ajax({
                url: "Attendance/QueryPage",
                data: data,
                type: "get",
                dataType: "json",
                contentType: "application/json;chartset=utf-8",
                success: function (res) {
                    if (res.code == 0) {
                        total = res.count;
                        page = res.pageIndex;
                        var tb = res.data;
                        SpliHtml(tb);
                        if (isRefresh) {
                            getPage();
                        }
                    }
                }

            });

        }
    </script>
    <div style="margin:20px;width:96%">
        <div class="layui-form-item">
            <label class="layui-form-label">编号</label>
            <div class="layui-input-inline" style="width:100px">
                <input id="txtUid" class="layui-input" type="text" placeholder="请输入" autocomplete="off" lay-verify="required">
            </div>
            <label class="layui-form-label">名称</label>
            <div class="layui-input-inline" style="width:100px">
                <input id="txtName" class="layui-input" type="text" placeholder="请输入" autocomplete="off" lay-verify="required">
            </div>
            <label class="layui-form-label">时间起</label>
            <div class="layui-input-inline" style="width:100px">
                <input name="date" class="layui-input" id="dtStartTime" placeholder="yyyy-MM-dd" type="text" autocomplete="off">
            </div>
            <label class="layui-form-label">时间止</label>
            <div class="layui-input-inline" style="width:100px">
                <input name="date" class="layui-input" id="dtEndTime" placeholder="yyyy-MM-dd" type="text" autocomplete="off">
            </div>
            <button class="layui-btn" type="submit" onclick="Query()">查询</button>
        </div>
        <table class="layui-table">
            <thead>
                <tr>
                    <th>船员编号</th>
                    <th>船员名称</th>
                    <th>打卡时间</th>
                    <th>考勤</th>
                    <th>略缩图</th>
                </tr>
            </thead>
            <tbody id="tblist">
            </tbody>
        </table>
        <div id="pages" class="center"></div>
    </div>*@
